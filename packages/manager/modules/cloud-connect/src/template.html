<div data-ui-view>
    <oui-page-header
        data-heading="{{ ::$ctrl.cloudConnect.description }}"
        data-description="{{ ::$ctrl.cloudConnect.uuid }}"
    >
        <oui-guide-menu data-text="{{ ::'cloud_connect_guides' | translate }}">
            <oui-guide-menu-item
                data-text="{{ ::'cloud_connect_guides_main' | translate }}"
                data-href="{{:: $ctrl.GUIDELINK.main.EN }}"
                data-external
            >
            </oui-guide-menu-item>
        </oui-guide-menu>
    </oui-page-header>
    <div class="container-fluid cui-page__content cui-page__content-flex">
        <!-- error messages -->
        <cui-message-container
            data-messages="$ctrl.messages"
        ></cui-message-container>

        <h2 class="pt-2" data-translate="cloud_connect_title"></h2>
        <p data-translate="cloud_connect_detail_decription"></p>

        <div class="row d-lg-flex">
            <!-- Information tile -->
            <div class="col-sm-12 col-md-4">
                <div class="oui-tile">
                    <div class="d-flex flex-row">
                        <h4
                            class="flex-grow-1 oui-heading_4 oui-tile__title"
                            data-translate="cloud_connect_informations"
                        ></h4>
                        <oui-action-menu
                            data-compact
                            data-align="end"
                            class="ml-auto"
                        >
                            <oui-action-menu-item
                                data-text="{{ ::'cloud_connect_ola_download' | translate }}"
                            ></oui-action-menu-item>
                        </oui-action-menu>
                    </div>
                    <!-- UUID -->
                    <oui-tile-definition
                        data-term="Uuid"
                        data-description="{{ ::$ctrl.cloudConnect.uuid }}">
                    </oui-tile-definition>
                    <!-- description -->
                    <oui-tile-definition
                        data-term="{{ ::'cloud_connect_description' | translate }}"
                        data-description="{{ $ctrl.cloudConnect.description }}">
                        <oui-action-menu data-compact data-align="end">
                            <oui-action-menu-item
                                data-on-click="$ctrl.goToUpdateDescriptionPage($ctrl.cloudConnect.description)"
                                data-text="{{ ::'cloud_connect_update' | translate }}"
                            ></oui-action-menu-item>
                        </oui-action-menu>
                    </oui-tile-definition>
                    <!-- Creation date -->
                    <oui-tile-definition
                        data-term="{{ ::'cloud_connect_date_created' | translate }}">
                        <oui-tile-description>
                            <span data-ng-bind="$ctrl.serviceInfos.creationDate"></span>
                        </oui-tile-description>
                    </oui-tile-definition>
                    <!-- POP -->
                    <oui-tile-definition
                        data-term="PoP"
                        data-description="{{ ::$ctrl.POP_MAP[$ctrl.cloudConnect.pop] }}">
                    </oui-tile-definition>
                    <!-- vRack -->
                    <oui-tile-definition
                        data-term="vRack">
                        <oui-tile-description
                            data-ng-if="!$ctrl.cloudConnect.isVrackAssociated()">
                            <span>-</span>
                            <button
                                class="oui-button oui-button_link d-block pl-0"
                                data-ng-click="$ctrl.goToAssociateVrackPage()"
                            >
                                {{ ::'cloud_connect_vrack_associate' |
                                translate }}
                            </button>
                        </oui-tile-description>
                        <oui-tile-description
                            data-ng-if="$ctrl.cloudConnect.isVrackAssociated()">
                            <span
                                data-ng-bind="$ctrl.cloudConnect.vrack"
                            ></span>
                                </dd>
                        </oui-tile-description>
                        <oui-action-menu
                            data-ng-if="$ctrl.cloudConnect.isVrackAssociated()"
                            data-compact>
                            <oui-action-menu-item
                                data-on-click="$ctrl.goToRemoveVrackPage($ctrl.cloudConnect.vrack)"
                                data-text="{{ ::'cloud_connect_vrack_remove' | translate }}">
                            </oui-action-menu-item>
                        </oui-action-menu>
                    </oui-tile-definition>
                    <!-- status -->
                    <oui-tile-definition
                        data-term="{{ ::'cloud_connect_status' | translate }}">
                        <oui-tile-description>
                            <span
                                class="oui-status"
                                data-ng-class="{
                                    'oui-status_error': $ctrl.cloudConnect.status === 'closed',
                                    'oui-status_success': $ctrl.cloudConnect.status === 'active'
                                }"
                                data-ng-bind="'cloud_connect_status_' +  $ctrl.cloudConnect.status | translate"
                            ></span>
                        </oui-tile-description>
                    </oui-tile-definition>
                    <!-- bandwidth   -->
                    <oui-tile-definition
                        data-term="{{ ::'cloud_connect_bandwidth' | translate }}"
                        data-description="{{ ::$ctrl.getBandwidth($ctrl.cloudConnect.bandwidth) }}">
                    </oui-tile-definition>
                    <!-- ports -->
                    <oui-tile-definition
                        data-term="{{ ::'cloud_connect_number_of_ports' | translate }}"
                        data-description="{{ ::$ctrl.cloudConnect.portQuantity }}">
                    </oui-tile-definition>
                </div>
            </div>

            <!-- Configure POP tile -->
            <div
                class="col-sm-12 col-md-4"
                data-ng-if="$ctrl.cloudConnect.isVrackAssociated()"
                data-ng-repeat="interfaceId in $ctrl.cloudConnect.interfaceList track by interfaceId"
            >
                <div class="oui-tile">
                    <div class="d-flex flex-row">
                        <h4
                            class="flex-grow-1 oui-heading_4 oui-tile__title"
                            data-translate="cloud_connect_pop_configure">
                        </h4>
                        <oui-action-menu
                            data-ng-if="!$ctrl.cloudConnect.isLoadingPop() && $ctrl.cloudConnect.isPopConfigured(interfaceId)"
                            data-compact
                            data-align="end"
                            class="ml-auto">
                            <oui-action-menu-item
                                data-text="{{ ::'cloud_connect_pop_configure_delete' | translate }}">
                            </oui-action-menu-item>
                        </oui-action-menu>
                    </div>
                    <oui-tile-definition data-ng-if="$ctrl.cloudConnect.isLoadingPop()">
                        <oui-tile-description>
                            <oui-spinner data-size="m"></oui-spinner>
                        </oui-tile-description>
                    </oui-tile-definition>
                    <!-- add configure -->
                    <oui-tile-definition
                        data-ng-if="
                            !$ctrl.cloudConnect.isLoadingPop() &&
                            !$ctrl.cloudConnect.isPopConfigured(interfaceId)"
                    >
                        <oui-tile-description>
                            <oui-button
                                data-variant="primary"
                                data-text="{{ ::'cloud_connect_pop_configure_add' | translate }}"
                                data-ng-click="$ctrl.goToPopConfigurationPage(interfaceId)"
                            >
                            </oui-button>
                        </oui-tile-description>
                    </oui-tile-definition>
                    <div data-ng-if="
                        !$ctrl.cloudConnect.isLoadingPop() &&
                        $ctrl.cloudConnect.isPopConfigured(interfaceId)"
                        data-ng-init="
                            $pop = $ctrl.cloudConnect.getPopConfiguration(interfaceId);
                            $interface = $ctrl.cloudConnect.getInterface(interfaceId);
                        ">
                        <!-- type of pop -->
                        <oui-tile-definition
                            data-term="{{ ::'cloud_connect_pop_configuration_type' | translate }}"
                            data-description="{{ ::$ctrl.getPopTypeName($pop.type) }}">
                        </oui-tile-definition>
                        <!-- port -->
                        <oui-tile-definition
                            data-term="{{ ::'cloud_connect_pop_port_id' | translate }}"
                            data-description="{{ ::interfaceId }}">
                        </oui-tile-definition>
                        <!-- port lock/unlock -->
                        <oui-tile-definition data-term="{{ ::'cloud_connect_pop_port_lock' | translate }}">
                            <oui-tile-description>
                                <span class="d-inline-block align-bottom">
                                    <span class="pr-2" data-ng-bind="$interface.localeLightLastUpdate"></span>
                                    <i
                                        data-ng-if="$interface.isEnabled()"
                                        class="oui-icon oui-icon-padlock-opened_concept oui-color-primary"
                                        aria-hidden="true">
                                    </i>
                                    <i
                                        data-ng-if="!$interface.isEnabled()"
                                        class="oui-icon oui-icon-padlock-closed_concept oui-color-primary"
                                        aria-hidden="true">
                                    </i>
                                </span>
                            </oui-tile-description>
                            <oui-action-menu
                                data-compact
                                data-align="end"
                                class="ml-auto">
                                <oui-action-menu-item
                                    data-ng-if="$interface.isEnabled()"
                                    data-text="{{ ::'cloud_connect_pop_port_block' | translate }}">
                                </oui-action-menu-item>
                                <oui-action-menu-item
                                    data-ng-if="!$interface.isEnabled()"
                                    data-text="{{ ::'cloud_connect_pop_port_unblock' | translate }}">
                                </oui-action-menu-item>
                            </oui-action-menu>
                        </oui-tile-definition>
                        <!-- optique status -->
                        <oui-tile-definition data-term="{{ ::'cloud_connect_pop_interface_status' | translate }}">
                            <oui-tile-description>
                                <span
                                    class="oui-status"
                                    data-ng-class="{
                                        'oui-status_success': $interface.isIncomingLightStatusUp(),
                                        'oui-status_error': !$interface.isIncomingLightStatusDown(),
                                        'oui-status_info': !$interface.isIncomingLightStatusUnknown(),
                                    }"
                                    data-ng-bind="'IN'"
                                ></span>
                                <span
                                    class="oui-status"
                                    data-ng-class="{
                                        'oui-status_success': $interface.isOutgoingLightStatusUp(),
                                        'oui-status_error': !$interface.isOutgoingLightStatusDown(),
                                        'oui-status_info': !$interface.isOutgoingLightStatusUnknown(),
                                    }"
                                    data-ng-bind="'OUT'"
                                ></span>
                            </oui-tile-description>
                        </oui-tile-definition>
                        <!-- status -->
                        <oui-tile-definition data-term="{{ ::'cloud_connect_pop_status' | translate }}">
                            <oui-tile-description>
                                <span
                                    class="oui-status"
                                    data-ng-class="{
                                        'oui-status_error': $pop.isError(),
                                        'oui-status_success': $pop.isActive(),
                                        'oui-status_warning': !$pop.isActive()
                                    }"
                                    data-ng-bind="'cloud_connect_pop_status_' +  $pop.status | translate"
                                ></span>
                            </oui-tile-description>
                        </oui-tile-definition>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
